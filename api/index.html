<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Home</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Home</h1>

    



    


    <h3> </h3>










    




    <section>
        <article><h1>StdioContext</h1><p><a href="https://travis-ci.org/kevinoid/stdio-context"><img src="https://img.shields.io/travis/kevinoid/stdio-context/master.svg?style=flat&amp;label=build+on+linux" alt="Build Status: Linux"></a>
<a href="https://ci.appveyor.com/project/kevinoid/stdio-context"><img src="https://img.shields.io/appveyor/ci/kevinoid/stdio-context/master.svg?style=flat&amp;label=build+on+windows" alt="Build Status: Windows"></a>
<a href="https://codecov.io/github/kevinoid/stdio-context?branch=master"><img src="https://img.shields.io/codecov/c/github/kevinoid/stdio-context.svg?style=flat" alt="Coverage"></a>
<a href="https://david-dm.org/kevinoid/stdio-context"><img src="https://img.shields.io/david/kevinoid/stdio-context.svg?style=flat" alt="Dependency Status"></a>
<a href="https://www.npmjs.com/package/stdio-context"><img src="https://img.shields.io/node/v/stdio-context.svg?style=flat" alt="Supported Node Version"></a>
<a href="https://www.npmjs.com/package/stdio-context"><img src="https://img.shields.io/npm/v/stdio-context.svg?style=flat" alt="Version on NPM"></a></p>
<p>A Node.js library to replace <code>stdin</code>, <code>stdout</code>, and/or <code>stderr</code>, including <code>console</code> methods, with arbitrary streams in a controlled way for capture, redirection, testing, or other purposes.</p>
<h2>Introductory Example</h2><pre class="prettyprint source lang-js"><code>var StdioContext = require('stdio-context');
var assert = require('assert');
var stream = require('stream');

var myStdin = new stream.PassThrough({objectMode: true});
var myStdout = new stream.PassThrough({objectMode: true});
var myStderr = new stream.PassThrough({objectMode: true});

var myStdioContext = new StdioContext({
  stdin: myStdin,
  stdout: myStdout,
  stderr: myStderr
});

function doStdioStuff() {
  myStdin.write('in stuff');
  assert.strictEqual(process.stdin.read(), 'in stuff');
  process.stdout.write('out stuff');
  assert.strictEqual(myStdout.read(), 'out stuff');
  process.stderr.write('err stuff');
  assert.strictEqual(myStderr.read(), 'err stuff');
  console.log('console.log stuff');
  assert.strictEqual(myStdout.read(), 'console.log stuff\n');
  console.error('console.error stuff');
  assert.strictEqual(myStderr.read(), 'console.error stuff\n');
}

var wrappedStdioStuff = myStdioContext.wrap(doStdioStuff);
wrappedStdioStuff();</code></pre><h2>Features</h2><ul>
<li>Supports replacing (monkey patching) <code>process.stdin</code>, <code>process.stdout</code>, and
<code>process.stderr</code> in a controlled and scope-limited way that is
exception-safe.</li>
<li>Replaces the global <code>console</code> object as necessary to capture output written
via <code>console</code>.</li>
<li>Uses plain Node streams, allowing redirection to files, sockets,
compression, encryption, or any other behavior exposing a stream interface.</li>
<li>Supports wrapping synchronous and asynchronous functions returning
<code>Promise</code> or accepting a callback function.</li>
<li>Supports discarding input and/or output without encoding or buffering.</li>
<li>Checks for changes to stdio streams by other code and can either overwrite,
throw, or preserve the changes (based on constructor options).</li>
<li>Contexts can be nested and are reentrant, allowing overlapping use by
multiple libraries without conflict.</li>
</ul>
<h2>Installation</h2><p><a href="https://www.npmjs.com/package/stdio-context">This package</a> can be
installed using <a href="https://www.npmjs.com/">npm</a>, either globally or locally, by
running:</p>
<pre class="prettyprint source lang-sh"><code>npm install stdio-context</code></pre><h2>Recipes</h2><h3>Redirect stdio to/from files.</h3><pre class="prettyprint source lang-js"><code>var StdioContext = require('stdio-context');
var fs = require('fs');

var inStream = fs.createReadStream('input.txt', {encoding: 'utf8'});
var outStream = fs.createReadStream('output.txt');

var myStdioContext = new StdioContext({
  stdin: inStream,
  stdout: outStream,
  stderr: outStream
});

function doStdioStuff() {
  process.stdin.read();         // content from input.txt
  console.log('out stuff');     // content sent to output.txt
  console.error('err stuff');   // content also sent to output.txt
}

myStdioContext.exec(doStdioStuff);</code></pre><h3>Discard input and/or output</h3><pre class="prettyprint source lang-js"><code>var StdioContext = require('stdio-context');
var assert = require('assert');

var myStdioContext = new StdioContext({
  stdin: null,
  stdout: null
});

function doStdioStuff() {
  assert.strictEqual(process.stdin.read(), null);
  console.log('out stuff');         // discarded without error
  console.error('Look at me!');     // sent to original process.stderr
}

myStdioContext.exec(doStdioStuff);</code></pre><h3>Redirect for asynchronous function</h3><pre class="prettyprint source lang-js"><code>var StdioContext = require('stdio-context');
var fs = require('fs');

var inStream = fs.createReadStream('input.txt', {encoding: 'utf8'});
var outStream = fs.createReadStream('output.txt');

var myStdioContext = new StdioContext({
  stdin: inStream,
  stdout: outStream,
  stderr: outStream
});

function doStdioStuff(cb) {
  // Resolving the Promise or calling the callback exits the context
  return new Promise(function(resolve, reject) {
    process.nextTick(function() {
      process.stdin.read();         // content still from input.txt
      console.log('out stuff');     // content still sent to output.txt
      console.error('err stuff');   // content also sent to output.txt

      // Either of these would exit the context
      cb();
      resolve();
    });
  });
}

var wrappedStdioStuff = myStdioContext.wrap(doStdioStuff);

function callback() {}
function onThen() {}
wrappedStdioStuff(callback).then(onThen);</code></pre><p>More examples can be found in the <a href="https://kevinoid.github.io/stdio-context/spec">test
specifications</a>.</p>
<h2>API Docs</h2><p>For a description of the available types, methods, and their arguments, see
the <a href="https://kevinoid.github.io/stdio-context/api">API Documentation</a>.</p>
<h2>Similar Packages</h2><p>If this package does not fit your needs, you may be interested in similar
packages:</p>
<ul>
<li><a href="https://github.com/NetOxygen/console-monkey-patch">console-monkey-patch</a> -
Replaces the methods of <code>console</code> with functions provided by the caller.</li>
<li><a href="https://github.com/mattdesl/console-redirect">console-redirect</a> - Replaces
the methods of <code>console</code> to write to caller-provided streams (and optionally
the <code>process</code> streams).</li>
<li><a href="https://github.com/sindresorhus/hook-std">hook-std</a> - Replaces the <code>.write</code>
method of <code>stdout</code> and/or <code>stderr</code> with a user-provided function.</li>
<li><a href="https://github.com/digplan/loghooks-node">loghooks-node</a> - Replaces the
<code>.write</code> method of <code>stdout</code>/<code>stderr</code> with a user-provided function and
provides convenience functions for writing to file or socket.</li>
<li><a href="https://github.com/stringparser/stdout-monkey">stdout-monkey</a> - Replaces or
observes the <code>.write</code> method of <code>stdout</code>.</li>
</ul>
<h2>Contributing</h2><p>Contributions are welcome and very much appreciated!  Please add tests to
cover any changes and ensure <code>npm test</code> passes.</p>
<p>If the desired change is large, complex, backwards-incompatible, can have
significantly differing implementations, or may not be in scope for this
project, opening an issue before writing the code can avoid frustration and
save a lot of time and effort.</p>
<h2>License</h2><p>This package is available under the terms of the
<a href="https://opensource.org/licenses/MIT">MIT License</a>.</p></article>
    </section>






</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="StdioContext.html">StdioContext</a></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Fri Feb 24 2017 22:09:10 GMT-0700 (MST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>